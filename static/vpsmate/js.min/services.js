angular.module("vpsmate.services",[]).factory("Auth",["$rootScope","$http","$location",function(a,d,c){var b={};b.required=function(f,e){d.post("/authstatus").success(function(g){if(f){f.call(null,g.authed=="yes")}if(g.authed=="no"){a.loginto=c.path();if(a.loginto=="/"||a.loginto=="/logout"){a.loginto="/main"}c.path("/")}}).error(function(h,g){if(e){e.call(null,g)}})};b.getlastactive=function(e){d.get("/authstatus?"+Math.random()).success(function(f){if(e){e.call(null,f.lastactive)}})};return b}]).factory("Module",["$rootScope","$location",function(a,c){var b={};b.init=function(e,d){a.module=e;a.htmlTitle=d};b.initSection=function(d){var e=c.search().s;a.activeTabName=e?e:d};b.getSection=function(){return c.search().s};b.setSection=function(d){a.activeTabName=d};b.getParam=function(d){return c.search()[d]};return b}]).factory("Timeout",["$rootScope","$timeout",function(a,b){var c=function(h,g,f,d,e){if(f&&a.module!=f){return}if(d&&a[e]){return}if(!e){e="timeout"}a[e]=b(function(){if(a[e]){delete a[e]}if(!f||a.module==f){h.call()}},g)};return c}]).factory("Message",["$rootScope","$timeout",function(a,c){var b={};a.showSuccessMsg=false;a.showErrorMsg=false;a.showWarningMsg=false;a.showInfoMsg=false;a.msgTimeout=0;var d=function(){if(a.msgTimeout){c.cancel(a.msgTimeout)}a.msgTimeout=c(function(){a.showSuccessMsg=false;a.showErrorMsg=false;a.showInfoMsg=false;a.msgTimeout=0},5000)};b.setSuccess=function(f,e){a.successMessage=f;if(f){a.showSuccessMsg=true;a.showErrorMsg=false;a.showInfoMsg=false;if(!e){d()}}else{a.showSuccessMsg=false;a.showErrorMsg=false;a.showInfoMsg=false}};b.setError=function(f,e){a.errorMessage=f;if(f){a.showSuccessMsg=false;a.showErrorMsg=true;a.showInfoMsg=false;if(!e){d()}}else{a.showSuccessMsg=false;a.showErrorMsg=false;a.showInfoMsg=false}};b.setInfo=function(f,e){a.infoMessage=f;if(f){a.showSuccessMsg=false;a.showErrorMsg=false;a.showInfoMsg=true;if(!e){d()}}else{a.showSuccessMsg=false;a.showErrorMsg=false;a.showInfoMsg=false}};b.setWarning=function(f,e){a.warningMessage=f;if(f){a.showWarningMsg=true;if(!e){d()}}else{a.showWarningMsg=false}};return b}]).factory("Request",["$http","$rootScope","$location","$timeout","Message",function(h,b,g,e,d){var c={};var f=function(j,i){return function(k){b.processing=false;if(!i&&k.msg){if(k.code==0){d.setSuccess(k.msg)}else{if(k.code==-1){d.setError(k.msg)}else{if(k.code==1){d.setWarning(k.msg)}else{if(k.code==2){d.setInfo(k.msg)}}}}}if(j){j.call(null,k)}}};var a=function(j,i){return function(l,k){b.processing=false;if(!i&&j){if(!j.call(null,l,k)){return}}if(k==403){d.setError("登录无效或超时，请重新登录。",true);g.path("/")}else{d.setError("发生未知错误！")}}};c.setProcessing=function(i){b.processing=i};c.get=function(k,m,l,j){b.processing=true;var i=b.$proxyroot+k;if(i.indexOf("?")>0){i+="&"+Math.random()}else{i+="?"+Math.random()}h.get(i).success(f(m,j)).error(a(l,j))};c.post=function(j,l,m,k,i){b.processing=true;h.post(b.$proxyroot+j,l).success(f(m,i)).error(a(k,i))};return c}]).factory("Backend",["Timeout","Request",function(c,b){var a={};a.call=function(d,g,f,j,h,i,e){d.waiting=true;b.post(f,h,function(k){if(k.code==-1){if(i){if(typeof i.error=="function"){i.error.call(null,k.data)}}return}var l=function(){b.get(j,function(m){if(m.status=="finish"){d.waiting=false;if(m.code==0){if(i){if(typeof i=="function"){i.call(null,m)}else{if(typeof i.success=="function"){i.success.call(null,m)}}}}else{if(i){if(typeof i=="function"){i.call(null,m)}else{if(typeof i.error=="function"){i.error.call(null,m)}}}}}else{if(i){if(typeof i.wait=="function"){i.wait.call(null,m)}}c(l,500,g)}},false,e)};c(l,500,g)},function(k){if(i){if(typeof i.error=="function"){i.error.call(null,k)}}})};return a}]);