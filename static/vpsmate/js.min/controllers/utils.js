var UtilsCtrl=["$scope","Module","Request",function(a,d,c){var b="utils";d.init(b,"系统工具");a.loaded=true;a.rebootconfirm=function(){$("#rebootconfirm").modal()};a.reboot=function(){c.post("/operation/reboot")}}];var UtilsUserCtrl=["$scope","$routeParams","Module","Timeout","Request",function(b,a,e,f,d){var c="utils.user";e.init(c,"用户管理");e.initSection("user");b.loaded=true;b.loadUsers=function(){d.post("/operation/user",{action:"listuser"},function(g){if(g.code==0){b.users=g.data}},false,true)};b.loadGroups=function(){d.post("/operation/user",{action:"listgroup"},function(g){if(g.code==0){b.groups=g.data}},false,true)};b.useraddconfirm=function(){b.curuser={pw_name:"",pw_gecos:"",pw_gname:"",pw_shell:"/bin/bash",pw_passwd:"",pw_passwdc:"",createhome:true,lock:false};$("#useraddconfirm").modal()};b.useradd=function(){var g=b.curuser;g.action="useradd";d.post("/operation/user",g,function(h){if(h.code==0){b.loadUsers();b.loadGroups()}})};b.usermodconfirm=function(h){var g=b.users[h];b.curuser={pw_name:g.pw_name,pw_gecos:g.pw_gecos,pw_gname:g.pw_gname,pw_dir:g.pw_dir,pw_shell:g.pw_shell,pw_passwd:"",pw_passwdc:"",lock:g.lock};$("#usermodconfirm").modal()};b.usermod=function(){var g=b.curuser;g.action="usermod";d.post("/operation/user",g,function(h){if(h.code==0){b.loadUsers();b.loadGroups()}})};b.userdelconfirm=function(h){var g=b.users[h];b.curuser={pw_name:g.pw_name};$("#userdelconfirm").modal()};b.userdel=function(){d.post("/operation/user",{action:"userdel",pw_name:b.curuser.pw_name},function(g){if(g.code==0){b.loadUsers();b.loadGroups()}})};b.groupaddconfirm=function(){b.curgrp_name="";$("#groupaddconfirm").modal()};b.groupadd=function(){d.post("/operation/user",{action:"groupadd",gr_name:b.curgrp_name},function(g){if(g.code==0){b.loadGroups()}})};b.groupmodconfirm=function(g){b.curgrp_newname=b.curgrp_name=b.groups[g].gr_name;$("#groupmodconfirm").modal()};b.groupmod=function(){d.post("/operation/user",{action:"groupmod",gr_name:b.curgrp_name,gr_newname:b.curgrp_newname},function(g){if(g.code==0){b.loadGroups()}})};b.groupdelconfirm=function(g){b.curgrp_name=b.groups[g].gr_name;$("#groupdelconfirm").modal()};b.groupdel=function(){d.post("/operation/user",{action:"groupdel",gr_name:b.curgrp_name},function(g){if(g.code==0){b.loadGroups()}})};b.groupmemsaddconfirm=function(g){b.curgrp_name=b.groups[g].gr_name;b.curgrp_mem="";$("#groupmemsaddconfirm").modal()};b.groupmemsadd=function(){d.post("/operation/user",{action:"groupmems_add",gr_name:b.curgrp_name,mem:b.curgrp_mem},function(g){if(g.code==0){b.loadUsers();b.loadGroups()}})};b.groupmemsdelconfirm=function(g){b.curgrp_name=b.groups[g].gr_name;b.curgrp_mems=b.groups[g].gr_mem;b.curgrp_mem="";$("#groupmemsdelconfirm").modal()};b.groupmemsdel=function(){d.post("/operation/user",{action:"groupmems_del",gr_name:b.curgrp_name,mem:b.curgrp_mem},function(g){if(g.code==0){b.loadUsers();b.loadGroups()}})}}];var UtilsNetworkCtrl=["$scope","$routeParams","Module","Timeout","Message","Request",function(b,a,f,g,e,d){var c="utils.network";f.init(c,"网络设置");f.initSection("ip");b.restartMessage="是否要重启网络？";b.loaded=true;b.showRestartBtn=true;b.loadIfNames=function(){d.get("/utils/network/ifnames",function(h){b.ifnames=h.ifnames;b.ifname=b.ifnames[0];b.loadIfConfig(b.ifname)})};b.loadIfConfig=function(h){b.ifname=h;d.get("/utils/network/ifconfig/"+h,function(i){b.ip=i.ip;b.mask=i.mask;b.gw=i.gw})};b.saveIfConfig=function(){d.post("/utils/network/ifconfig/"+b.ifname,{ip:b.ip,mask:b.mask,gw:b.gw},function(h){if(h.code==0){b.loadIfConfig(b.ifname)}})};b.loadNameservers=function(){d.get("/utils/network/nameservers",function(h){b.nameservers=h.nameservers})};b.saveNameservers=function(){var h=[];$(".nameserver").each(function(){var i=$(this).val();if(i){h.push(i)}});d.post("/utils/network/nameservers",{nameservers:h.join(",")},function(i){if(i.code==0){b.loadNameservers()}})};b.addNameserver=function(){b.nameservers.push("")};b.delNameserver=function(h){b.nameservers.splice(h,1)};b.restart=function(){b.restartMessage="正在重启，请稍候...";b.showRestartBtn=false;g(function(){d.post("/backend/service_restart",{service:"network"},function(i){var h=function(){d.get("backend/service_restart_network",function(j){if(j.msg){b.restartMessage=j.msg}if(j.status=="finish"){e.setSuccess("");g(function(){b.restartMessage="是否要重启网络？";b.showRestartBtn=true},3000,c)}else{g(h,500,c)}})};g(h,500,c)})},1000,c)}}];var UtilsTimeCtrl=["$scope","$routeParams","Module","Timeout","Request","Backend",function(j,i,b,d,f,c){var e="utils.time";b.init(e,"时间设置");b.initSection("datetime");j.loaded=true;j.loadDatetime=function(){f.get("/utils/time/datetime",function(k){j.datetime=k;j.newDatetime=k.str})};j.saveDatetime=function(){f.post("/backend/datetime",{datetime:j.newDatetime},function(k){f.setProcessing(true);var l=function(){f.get("backend/datetime",function(m){if(m.status!="finish"){f.setProcessing(true);d(l,500,e)}})};d(l,500,e)})};j.loadTimezone=function(){f.get("/utils/time/timezone",function(l){var k=l.timezone;j.timezone=k?k:"时区不可识别";if(k){var m=k.split("/");j.timezone_region=m[0];j.timezone_city=m[1]}else{j.timezone_region="Asia";j.timezone_city="Shanghai"}})};j.loadTimezones=function(l,k){if(l){f.get("/utils/time/timezone_list/"+l,function(m){j.cities=m.cities;if(k){k.call()}})}else{f.get("/utils/time/timezone_list",function(n){j.regions=n.regions;var m=function(){f.get("/utils/time/timezone_list/"+j.timezone_region,function(o){j.cities=o.cities})};if(j.timezone_region){m()}else{d(m,500,e)}})}};j.setTimezone=function(l,k){j.timezone_region=l;j.loadTimezones(l,function(){j.timezone_city=k})};j.saveTimezone=function(){var l=j.timezone_region;var k=j.timezone_city;f.post("/utils/time/timezone",{timezone:l+"/"+k},function(m){if(m.code==0){j.loadTimezone();j.loadDatetime()}})};j.synctime=function(){var k="pool.ntp.org";f.post("/backend/ntpdate",{server:k},function(l){f.setProcessing(true);var m=function(){f.get("backend/ntpdate_"+k,function(n){if(n.status!="finish"){f.setProcessing(true);d(m,500,e)}else{j.loadDatetime()}})};d(m,500,e)})};j.ntpdChecking=true;var a=function(){j.installMessage="时间同步需要使用 NTP 服务，您当前尚未安装该服务。<br>是否安装？";j.showInstallBtn=true};var h=function(){j.startMessage="NTP 服务已安装但还未启动，是否启动？";j.showStartBtn=true};var g=function(){j.stopMessage="NTP 服务正在运行，是否停止？";j.showStopBtn=true};a();h();g();j.loadSync=function(){f.get("/query/service.ntpd",function(k){j.ntpdStatus=null;if(k["service.ntpd"]){j.ntpdStatus=k["service.ntpd"]["status"]}j.ntpdChecking=false})};j.install=function(){j.installMessage="正在安装，请稍候...";j.showInstallBtn=false;c.call(j,e,"/backend/yum_install","/backend/yum_install_base_ntp",{repo:"base",pkg:"ntp"},{wait:function(k){j.installMessage=k.msg},success:function(k){j.installMessage=k.msg;d(j.loadSync,3000,e)},error:function(k){j.installMessage=k.msg;d(j.loadSync,3000,e)}},true)};j.start=function(){j.startMessage="正在启动，请稍候...";j.showStartBtn=false;c.call(j,e,"/backend/service_start","/backend/service_start_ntpd",{name:"NTP",service:"ntpd"},{wait:function(k){j.startMessage=k.msg},success:function(k){j.startMessage=k.msg;d(function(){h();j.loadSync()},3000,e)},error:function(k){j.startMessage=k.msg;d(function(){h();j.loadSync()},3000,e)}},true)};j.stop=function(){j.stopMessage="正在停止，请稍候...";j.showStopBtn=false;c.call(j,e,"/backend/service_stop","/backend/service_stop_ntpd",{name:"NTP",service:"ntpd"},{wait:function(k){j.stopMessage=k.msg},success:function(k){j.stopMessage=k.msg;d(function(){g();j.loadSync()},3000,e)},error:function(k){j.stopMessage=k.msg;d(function(){g();j.loadSync()},3000,e)}},true)}}];var UtilsPartitionCtrl=["$scope","Module","Timeout","Request","Message","Backend",function(b,f,g,e,d,a){var c="utils.partition";f.init(c,"磁盘分区");b.loaded=false;b.waiting=true;b.loadDiskinfo=function(){e.get("/query/server.diskinfo",function(h){if(!b.loaded){b.loaded=true}b.diskinfo=h["server.diskinfo"];b.waiting=false})};b.swaponconfirm=function(h){b.devname=h;$("#swaponconfirm").modal()};b.swapon=function(){a.call(b,c,"/backend/swapon","/backend/swapon_on_"+b.devname,{devname:b.devname},{success:b.loadDiskinfo})};b.swapoffconfirm=function(h){b.devname=h;$("#swapoffconfirm").modal()};b.swapoff=function(){a.call(b,c,"/backend/swapoff","/backend/swapon_off_"+b.devname,{devname:b.devname},{success:b.loadDiskinfo})};b.umountconfirm=function(h){b.devname=h;$("#umountconfirm").modal()};b.umount=function(){a.call(b,c,"/backend/umount","/backend/mount_umount_"+b.devname,{devname:b.devname},{success:b.loadDiskinfo})};b.mountconfirm=function(h,i){b.devname=h;b.mountpoint="";b.fstype=i;e.get("/query/config.fstab("+h+")",function(j){if(j["config.fstab"]&&typeof(j["config.fstab"]["mount"])!="undefined"){b.mountpoint=j["config.fstab"]["mount"]}});$("#mountconfirm").modal()};b.selectmountpoint=function(h){b.selector_title="请选择挂载点";b.selector.onlydir=true;b.selector.onlyfile=false;b.selector.load(b.mountpoint?b.mountpoint:"/");b.selector.selecthandler=function(i){$("#selector").modal("hide");b.mountpoint=i};$("#selector").modal()};b.mount=function(){a.call(b,c,"/backend/mount","/backend/mount_mount_"+b.devname,{devname:b.devname,mountpoint:b.mountpoint,fstype:b.fstype},{success:b.loadDiskinfo})};b.formatconfirm=function(h){b.devname=h;e.get("/query/tool.supportfs",function(i){b.supportfs=i["tool.supportfs"]});$("#formatconfirm").modal()};b.format=function(){a.call(b,c,"/backend/format","/backend/format_"+b.devname,{devname:b.devname,fstype:b.fstype},{success:b.loadDiskinfo})};b.addpartconfirm=function(h,i){b.devname=h;b.unpartition=i;$("#addpartconfirm").modal()};b.addpart=function(){b.waiting=true;d.setInfo("正在 "+b.devname+" 上创建分区，请稍候...",true);e.post("/operation/fdisk",{action:"add",devname:b.devname,size:b.size,unit:b.unit},function(h){if(h.code==0){b.loadDiskinfo()}else{b.waiting=false}})};b.delpartconfirm=function(h){b.devname=h;$("#delpartconfirm").modal()};b.delpart=function(){b.waiting=true;d.setInfo("正在删除分区 "+b.devname+"，请稍候...",true);e.post("/operation/fdisk",{action:"delete",devname:b.devname},function(h){if(h.code==0){b.loadDiskinfo()}else{b.waiting=false}})};b.scanpartconfirm=function(h){b.devname=h;$("#scanpartconfirm").modal()};b.scanpart=function(){b.waiting=true;d.setInfo("正在扫描 "+b.devname+" 的分区，请稍候...",true);e.post("/operation/fdisk",{action:"scan",devname:b.devname},function(h){if(h.code==0){g(b.loadDiskinfo,1000,c)}else{b.waiting=false}})}}];var UtilsAutoFMCtrl=["$scope","Module","Timeout","Request","Message","Backend",function(b,f,g,e,d,a){var c="utils.autofm";f.init(c,"自动格式化挂载");b.loaded=false;b.waiting=true;b.diskcount=0;b.loadDiskinfo=function(){e.get("/query/server.diskinfo",function(j){if(!b.loaded){b.loaded=true}b.diskinfo=j["server.diskinfo"];b.waiting=false;b.diskcount=0;for(var h in j["server.diskinfo"]["partitions"]){var k=j["server.diskinfo"]["partitions"][h];if(k.is_hw&&!k.is_pv&&k.partcount==0&&!k.mount){b.diskcount++}}})};b.confirm=function(h){b.devname=h;b.mountpoint="";b.fstype="";e.post("/operation/file",{action:"listdir",path:"/data",showhidden:true,remember:false},function(l){if(l.code==0){var j=l.data;if(j.length==0){b.mountpoint="/data/0"}else{var m={};for(var k=0;k<j.length;k++){m[j[k].name]=true}var n=0;while(1){if(!m[""+n]){break}n++}b.mountpoint="/data/"+n}}else{e.post("/operation/file",{action:"createfolder",path:"/",name:"data"});b.mountpoint="/data/0"}},false,true);e.get("/query/tool.supportfs",function(l){var j=l["tool.supportfs"];for(var k=0;k<j.length;k++){if(j[k]=="swap"){j.splice(k,1)}if(j[k]=="xfs"){b.fstype="xfs"}else{if(j[k]=="ext4"){b.fstype="ext4"}else{if(j[k]=="ext3"){b.fstype="ext3"}}}}b.supportfs=j});$("#confirm").modal()};b.selectmountpoint=function(h){b.selector_title="请选择挂载点";b.selector.onlydir=true;b.selector.onlyfile=false;b.selector.load(b.mountpoint);b.selector.selecthandler=function(i){$("#selector").modal("hide");b.mountpoint=i};$("#selector").modal()};b.autofm=function(){e.post("/operation/file",{action:"listdir",path:b.mountpoint,showhidden:true,remember:false},function(l){if(l.code==0){var h=l.data;if(h.length>0){var o=false;for(var k=0;k<h.length;k++){if(h[k].name=="lost+found"){o=true;break}}if(o){d.setError("已有其它设备挂载在 "+b.mountpoint+" 下，请重新选择挂载点。")}else{d.setError("挂载点 "+b.mountpoint+" 下存在文件或目录，无法挂载！请重新选择挂载点。")}}else{b.format()}}else{var n=b.mountpoint.split("/");var j=n.pop();var m=n.join("/");e.post("/operation/file",{action:"createfolder",path:m,name:j},b.format)}},false,true)};b.mount=function(){a.call(b,c,"/backend/mount","/backend/mount_mount_"+b.devname,{devname:b.devname,mountpoint:b.mountpoint,fstype:b.fstype},{success:b.loadDiskinfo})};b.format=function(){a.call(b,c,"/backend/format","/backend/format_"+b.devname,{devname:b.devname,fstype:b.fstype},{success:b.mount})}}];var UtilsMoveDataCtrl=["$scope","Module","Timeout","Request","Message","Backend",function(b,f,g,e,d,a){var c="utils.movedata";f.init(c,"数据移至数据盘");b.loaded=false;b.waiting=true;b.srcpath="/var";b.despath="/";b.mountpoint="/";b.loadMounts=function(){e.get("/query/server.mounts",function(h){if(!b.loaded){b.loaded=true}b.mounts=h["server.mounts"];b.waiting=false})};b.setdespath=function(h){b.despath=h};b.selectsrcpath=function(h){b.selector_title="请选择要迁移的目录（原始目录）";b.selector.onlydir=true;b.selector.onlyfile=false;b.selector.load(b.srcpath);b.selector.selecthandler=function(i){$("#selector").modal("hide");b.srcpath=i};$("#selector").modal()};b.selectdespath=function(h){b.selector_title="请选择要迁移到的目录（目标目录）";b.selector.onlydir=true;b.selector.onlyfile=false;b.selector.load(b.despath);b.selector.selecthandler=function(i){$("#selector").modal("hide");b.despath=i};$("#selector").modal()};b.movedata=function(){b.waiting=true;var i=b.srcpath.replace(/\/$/,"");var j=i.split("/").pop();var h=b.despath.replace(/\/$/,"")+"/"+j;if(h==i){d.setError("路径没有改变，无须迁移！");b.waiting=false;return}d.setInfo("正在检测，请稍候...",true);e.post("/operation/file",{action:"getitem",path:i},function(k){if(k.code==0){if(!k.data.isdir){d.setError(b.srcpath+" 不是有效的目录！（可能是文件或链接）");b.waiting=false;return}e.post("/operation/file",{action:"getitem",path:h},function(l){if(l.code==0){d.setError("目标目录下已有同名文件或目录 "+h+"，迁移失败！");b.waiting=false}else{a.call(b,c,"/backend/move","/backend/move_"+i+"_"+h,{srcpath:i,despath:h},{success:function(m){d.setInfo("正在原始目录创建链接...");e.post("/operation/file",{action:"link",srcpath:h,despath:i},function(n){if(n.code==0){d.setSuccess("迁移完成！")}else{d.setError("迁移失败！"+n.msg)}b.waiting=false},false,true)},error:function(m){d.setError("迁移过程中发生错误，迁移失败！");b.waiting=false}})}},false,true)}})}}];