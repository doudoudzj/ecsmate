var LoginCtrl=["$scope","$rootScope","$location","Module","Message","Request",function(b,a,h,f,e,d){var c="login";f.init(c,"登录");b.loginText="登录";b.showForgetPwdMsg=false;b.showLoginForm=true;b.username="";b.password="";var g=function(m){var l=new RegExp("^(?=.{8,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\\W).*$","g");var k=new RegExp("^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$","g");var j=new RegExp("(?=.{6,}).*","g");if(false==j.test(m)){return"无安全性可言"}else{if(l.test(m)){return"高"}else{if(k.test(m)){return"一般"}else{return"低"}}}};b.login=function(j){b.loginText="登录中...";d.post("/login",{username:b.username,password:j?b.password:hex_md5(b.password)},function(k){if(k.code>=0){b.showLoginForm=false;var l=a.loginto?a.loginto:"/main";if(k.code==0){h.path(l)}else{b.pwdStrength=g(b.password);if(b.pwdStrength!="高"){e.setError(false);e.setWarning(false);$("#main").hide();b.loginMessage=k.msg;b.loginWarning=true}else{h.path(l)}}}else{b.loginText="登录"}})}}];var LogoutCtrl=["$scope","$location","Module","Request","Timeout",function(a,f,d,c,e){var b="logout";d.init(b,"退出登录");a.loaded=false;e(function(){a.loaded=true;c.get("/xsrf",function(){c.post("/logout",{},function(g){e(function(){f.path("/")},3000,b)})})},1000,b)}];var deepUpdate=function(a,b){for(i in b){if(typeof(b[i])=="object"){deepUpdate(a[i],b[i])}else{if(a[i]!=b[i]){a[i]=b[i]}}}};var MainCtrl=["$scope","$routeParams","$location","Module","Timeout","Request","version",function(c,a,h,f,g,e,b){var d="main";f.init(d,"首页");f.initSection("server");c.version=b;c.info=null;c.loaded=false;c.detectVer=true;c.hasNewver=false;e.get("/setting/upver",function(k){if(k.code==-1){c.upverMessage=k.msg}else{if(k.code==0){var j=k.data;if(parseFloat(j.version)>parseFloat(b.version)||(parseFloat(j.version)==parseFloat(b.version)&&parseInt(j.build)>parseInt(b.build))){c.detectVer=false;c.hasNewver=true}}}});c.checkUpdate=function(){h.path("/setting");h.search("s","upversion")};c.loadInfo=function(j){if(!j){j="*"}e.get("/query/"+j,function(r){if(c.info==null){c.info=r;c.info["server.cpustat"]["total"]["used_rate"]="获取中...";for(var p=0;p<r["server.netifaces"].length;p++){c.info["server.netifaces"][p]["rx_speed"]="0";c.info["server.netifaces"][p]["tx_speed"]="0"}if(!c.loaded){c.loaded=true}}else{if(c.info){var q=r["server.cpustat"]["total"];var k=c.info["server.cpustat"]["total"];var s=(q.used-k.used)/(q.all-k.all);s=Math.round(s*10000)*10;var o=100000-s;s=((s+1)/1000).toString();o=((o+1)/1000).toString();q.used_rate=s.substring(0,s.length-1)+"%";q.idle_rate=o.substring(0,o.length-1)+"%";var n=r["server.netifaces"];var l=c.info["server.netifaces"];for(var p=0;p<n.length;p++){var m=n[p]["timestamp"]-l[p]["timestamp"];if(m>0){n[p]["rx_speed"]=Math.round((n[p]["rx_bytes"]-l[p]["rx_bytes"])/m);n[p]["tx_speed"]=Math.round((n[p]["tx_bytes"]-l[p]["tx_bytes"])/m)}}}deepUpdate(c.info,r)}g(c.loadInfo,1000,d)})}}];var FtpCtrl=["$scope","Module",function(a,c){var b="ftp";c.init(b,"FTP管理");a.loaded=true}];var TaskCtrl=["$scope","Module",function(a,c){var b="task";c.init(b,"计划任务");a.loaded=true}];var SettingCtrl=["$scope","$routeParams","Module","Timeout","Message","Request","version",function(c,a,g,h,f,e,b){var d="setting";g.init(d,"系统设置");g.initSection("authinfo");c.version=b;c.showUpdateBtn=false;c.showRestartBtn=true;c.loaded=true;c.password=c.passwordc="";c.loadAuthInfo=function(){e.get("/setting/auth",function(j){c.username=j.username;c.passwordcheck=j.passwordcheck})};c.loadServerInfo=function(){e.get("/setting/server",function(j){c.ip=j.ip;c.port=j.port})};c.loadAccessKey=function(){e.get("/setting/accesskey",function(j){c.accesskey=j.accesskey;c.enableaccesskey=j.enableaccesskey})};c.updateAuthInfo=function(){e.post("/setting/auth",{username:c.username,password:c.password?hex_md5(c.password):"",passwordc:c.passwordc?hex_md5(c.passwordc):"",passwordcheck:c.passwordcheck},function(j){if(j.code==0){c.loadAuthInfo()}})};c.updateServerInfo=function(){e.post("/setting/server",{port:c.port,ip:c.ip},function(){if(data.code==0){c.loadServerInfo()}})};c.updateAccessKey=function(){e.post("/setting/accesskey",{accesskey:c.accesskey,enableaccesskey:c.enableaccesskey},function(j){if(j.code==0){c.loadAccessKey()}})};c.checkUpVersion=function(){c.upverMessage="正在检测新版本...";e.get("/setting/upver?force=1",function(k){if(k.code==-1){c.upverMessage=k.msg}else{if(k.code==0){var j=k.data;if(parseFloat(j.version)>parseFloat(b.version)||(parseFloat(j.version)==parseFloat(b.version)&&parseInt(j.build)>parseInt(b.build))){c.upverMessage='<table class="table table-condensed"><thead><tr><th colspan="2">有可用的新版本</th></tr></thead><tbody><tr><td>版本信息：</td><td>v'+j.version+" b"+j.build+"</td></tr><tr><td>发布时间：</td><td>"+j.releasetime+'</td></tr><tr><td>变更记录：</td><td><a href="'+j.changelog+'" target="_blank">查看版本变更记录</a></td></tr></tbody></table>';c.updateBtnText="开始在线升级";c.showUpdateBtn=true}else{c.upverMessage="当前已是最新版本！"}}}})};c.update=function(){c.upverMessage="正在升级，请稍候...";c.showUpdateBtn=false;e.post("/backend/update",{},function(k){var j=function(){e.get("backend/update",function(l){f.setInfo("");if(l.msg){c.upverMessage=l.msg}if(l.status=="finish"&&l.code==0){c.upverMessage="正在重启 VPSMate...";h(function(){e.post("/backend/service_restart",{service:"vpsmate"},function(n){var m=function(){e.get("backend/service_restart_vpsmate",function(o){f.setInfo("");if(o.msg){c.upverMessage=o.msg}h(m,500,d)},function(p,o){if(o==403||o==0){c.upverMessage="升级成功！请刷新页面重新登录。";return false}return true})};h(m,500,d)})},1000,d)}else{h(j,500,d)}})};h(j,500,d)})};c.restartMessage="是否要重启 VPSMate？";c.restart=function(){c.restartMessage="正在重启，请稍候...";c.showRestartBtn=false;h(function(){e.post("/backend/service_restart",{service:"vpsmate"},function(k){var j=function(){e.get("backend/service_restart_vpsmate",function(l){if(l.msg){c.restartMessage=l.msg}h(j,500,d)},function(m,l){if(l==403||l==0){c.restartMessage="重启成功！请刷新页面重新登录。";return false}return true})};h(j,500,d)})},1000,d)};c.genaccesskey=function(){var l="";for(var k=0;k<32;k++){l+=String.fromCharCode(Math.floor(256*Math.random()))}var j=function(p){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o="";var v,t,s,w,u,r,q;var n=0;while(n<p.length){v=p.charCodeAt(n++);t=p.charCodeAt(n++);s=p.charCodeAt(n++);w=v>>2;u=((v&3)<<4)|(t>>4);r=((t&15)<<2)|(s>>6);q=s&63;if(isNaN(t)){r=q=64}else{if(isNaN(s)){q=64}}o=o+m.charAt(w)+m.charAt(u)+m.charAt(r)+m.charAt(q)}return o};c.accesskey=j(l)}}];var SorryCtrl=["$scope","Module","$timeout",function(a,d,c){var b="sorry";d.init(b,"页面不存在");a.loaded=true}];